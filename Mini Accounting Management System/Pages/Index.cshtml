@page
@model Mini_Accounting_Management_System.Pages.IndexModel
@using Microsoft.AspNetCore.Identity
@using Mini_Accounting_Management_System.Models

@inject SignInManager<User> SignInManager
@inject UserManager<User> UserManager
@{
    ViewData["Title"] = "Home page";
}

<div class="text-center">
    <h1 class="display-4">Welcome</h1>
    <p>Learn about <a href="https://learn.microsoft.com/aspnet/core">building Web apps with ASP.NET Core</a>.</p>

</div>
@if (User.Identity?.IsAuthenticated==true) {
    <div class="container my-5">
        <div class="text-center mb-4">
            <h2 class="fw-bold">Chart of Accounts</h2>
            <p class="text-muted">Click any account type to view its sub-accounts.</p>
        </div>

        <!-- 1) Account Types Table -->
        <div class="card mb-5">
            <div class="card-header bg-dark text-white"><strong>Account Types</strong></div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-striped mb-0">
                        <thead class="table-light">
                            <tr>
                                <th class="text-center">#</th>
                                <th>Account Type</th>
                                <th class="text-center">Total Balance</th>
                                <th class="text-center">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model.AccountTypes.Count == 0)
                            {
                                <tr>
                                    <td colspan="4" class="text-center text-muted py-3">
                                        No account types found.
                                    </td>
                                </tr>
                            }
                            else
                            {
                                var idx = 1;
                                foreach (var acctType in Model.AccountTypes)
                                {
                                    <tr>
                                        <td class="text-center">@idx</td>
                                        <td>@acctType.Acc_Type</td>
                                        <td class="text-end">@acctType.TotalBalance.ToString("C2")</td>
                                        <td class="text-center">
                                            <a class="btn btn-sm btn-primary"
                                               asp-route-TypeFilter="@acctType.Acc_Type">
                                                View
                                            </a>
                                        </td>
                                    </tr>
                                    idx++;
                                }
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 2) Sub-Accounts Table -->
        @if (!string.IsNullOrWhiteSpace(Model.TypeFilter))
        {
            <div class="card">
                <div class="card-header bg-secondary text-white d-flex justify-content-between">
                    <span>Sub-Accounts for: <strong>@Model.TypeFilter</strong></span>
                    <!-- Back button simply clears the query string by pointing to Index with no route -->
                    <a asp-page="./Index" class="btn btn-sm btn-light">← Back to Types</a>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="text-center">P_ID</th>
                                    <th>Sub-Account</th>
                                    <th class="text-end">Balance</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model.SubAccounts.Count == 0)
                                {
                                    <tr>
                                        <td colspan="3" class="text-center text-muted py-3">
                                            No sub-accounts found for “@Model.TypeFilter.”
                                        </td>
                                    </tr>
                                }
                                else
                                {
                                    foreach (var sub in Model.SubAccounts)
                                    {
                                        <tr>
                                            <td class="text-center">@sub.P_ID</td>
                                            <td>@sub.Sub_Acc</td>
                                            <td class="text-end">@sub.Balance.ToString("C2")</td>
                                        </tr>
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        }
    </div>
}

