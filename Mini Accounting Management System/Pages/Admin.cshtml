@page
@model Mini_Accounting_Management_System.Pages.AdminModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<h1>Manage User Roles</h1>

@if (TempData["Success"] != null)
{
    <div class="alert alert-success">@TempData["Success"]</div>
}

<table class="table table-bordered">
    <thead class="table-light">
        <tr>
            <th>UserName</th>
            <th>Current Role</th>
            <th style="width:30%">Action</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var u in Model.Users)
        {
            <tr>
                <td>@u.UserName</td>
                <td>@u.Email</td>
                <td>@u.RoleName</td>    
                <td>
                    <form method="post" asp-page-handler="AssignRole" class="d-flex">
                        <input type="hidden" name="SelectedUserName" value="@u.UserName" />

                        <select asp-for="SelectedRoleName" class="form-select me-2">
                            <option value="">-- select role --</option>
                            @foreach (var role in Model.AllRoles)
                            {
                                <option value="@role.RoleName">@role.RoleName</option>
                            }
                        </select>

                        <button type="submit" class="btn btn-primary">Assign</button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>

@if (!ModelState.IsValid)
{
    <div class="alert alert-danger mt-3">
        @foreach (var err in ViewData.ModelState.Values.SelectMany(v => v.Errors))
        {
            <div>@err.ErrorMessage</div>
        }
    </div>
}